<!DOCTYPE html>
<html>
  <head>
    <title>Python Websockets Chat Demo</title>
  </head>
  <body>
    <div class="container">
      <h1>Python Websockets Chat Demo</h1>
      <form id="input-form">
        <input id="input-handle" type="text" placeholder="Enter your name" autofocus />
        <input id="input-text" type="text" placeholder="Enter chat text here!" autofocus />
        <button type="submit">Send</button>
      </form>
      <h1>Chat Log</h1>
      <div id="chat-text">
      </div>
    </div>

    <script type="text/javascript" src="//code.jquery.com/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="static/reconnecting-websocket.js"></script>
    <script type="text/javascript">
var inbox = new ReconnectingWebSocket("ws://"+ location.host + "/receive/chat");
var outbox = new ReconnectingWebSocket("ws://"+ location.host + "/submit/chat");

inbox.onmessage = function(message) {
  var data = JSON.parse(message.data);
  $("#chat-text").append("<div>" + data.handle + ": " + data.text + "</div>");
};

inbox.onclose = function(){
    console.log('inbox closed');
    this.inbox = new WebSocket(inbox.url);

};

outbox.onclose = function(){
    console.log('outbox closed');
    this.outbox = new WebSocket(outbox.url);
};

$("#input-form").on("submit", function(event) {
  event.preventDefault();
  var handle = $("#input-handle")[0].value;
  var text   = $("#input-text")[0].value;
  outbox.send(JSON.stringify({ handle: handle, text: text }));
  $("#input-text")[0].value = "";
});
    </script>
  </body>
</html>
